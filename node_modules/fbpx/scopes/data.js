'use strict';

var util = require('util');
var Scope = require('dyslexer').Scope;

/**
 *
 * This is the data scope it is entered
 * when a quoted string is encountered.
 *
 * It will quit the scope when we reach
 * the same quote type (' or "), unless
 * that quote was escaped.
 *
 */
function DataScope(lexer) {
  Scope.apply(this, [lexer]);
}

util.inherits(DataScope, Scope);

DataScope.prototype.onEnter = function() {

  // We need to hint what is our tokenEnding
  // also causes space to no longer be the token ending.
  this.tokenEnding = [this.lexer.scoper];

  // whether the lexer should check for
  // an escape \ one char back.
  this.escape = true;
};

DataScope.prototype.onLineStart = function() {

  this.tokensExpected = 1;

};

DataScope.prototype.onToken = function(token) {

  if (this.lexer.scoper === '"') {
    var a = JSON.parse(
      '{ "a": ' + token + '}'
    );
    token = a.a;
  }

  this.lexer.present('DATA', token);
};

module.exports = DataScope;
